
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AMC Bio Signal</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" href="static/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="static/bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="static/bower_components/Ionicons/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="static/dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="static/dist/css/skins/_all-skins.min.css">

    <!-- Morris chart -->
    <link rel="stylesheet" href="static/bower_components/morris.js/morris.css">
    <!-- jvectormap -->
    <link rel="stylesheet" href="static/bower_components/jvectormap/jquery-jvectormap.css">
    <!-- Date Picker -->
    <link rel="stylesheet" href="static/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="static/bower_components/bootstrap-daterangepicker/daterangepicker.css">
    <!-- bootstrap wysihtml5 - text editor -->
    <link rel="stylesheet" href="static/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="static/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script type="text/javascript" src="http://tarruda.github.com/bootstrap-datetimepicker/assets/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="http://tarruda.github.com/bootstrap-datetimepicker/assets/js/bootstrap-datetimepicker.pt-BR.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Google Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
{#    chart#}
<style>
.nav-tabs{
    padding-top: 4px;
    padding-bottom: 4px;
    margin-top: -2px;
}
.nav-tabs li {
    padding-top: 4px;
    padding-bottom: 4px;
         margin-top: -2px;

}

.nav-tabs li  a {
    padding-top: 4px;
    padding-bottom: 4px;
    margin-top: -2px;

}

</style>


</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper" >

  <header class="main-header">
    <!-- Logo -->
    <a href="dashboard" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><b>A</b>N</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><b>A</b>nesthesiology</span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">

      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu" data-widget="tree">
        {% for key, val in sidebar_menu.items %}
          {% if val.active %}
            <li class="treeview active">
              {% else %}
            <li class="treeview">
          {% endif %}
          <li class="treeview">
            <a href="#">
              <i class="fa fa-dashboard"></i> <span>{{ key }}</span>
              <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu">
              {% for menu in val.submenu %}
                {% if menu.0 %}
                  <li class="active"><a href="{{ menu.2 }}"><i class="fa fa-circle-o"></i>{{ menu.1 }}</a></li>
                {% else %}
                  <li><a href="{{ menu.2 }}"><i class="fa fa-circle-o"></i>{{ menu.1 }}</a></li>
                {% endif %}
              {% endfor %}
            </ul>
          </li>
        {% endfor %}
      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        Dashboard Trend
      </h1>
      <ol class="breadcrumb">
        <li><a href="dashboard"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Dashboard</a></li>
        <li class="active">Dashboard Trend</li>
      </ol>
    </section>

    &nbsp;  &nbsp;&nbsp;&nbsp;

    <!DOCTYPE html>
    <div class="container-fluid ">

                <form    action="/dashboard_percent?st=st,et=et, device =device", method="get">
                    <div class="col-md-3">
                        <label for="datepicker" style="font-size:15px;">Begin date</label>
                        <input type="text" id="datepicker" name="st" autocomplete="off" size="15" maxlength="10">

                        <label for="datepicker2" style="font-size:15px;">End date</label>
                        <input type="text" id="datepicker2" name="et" autocomplete="off" size="15" maxlength="10">
                    </div>
                <div class="col-md-1 ">
                  <ul class="nav nav-tabs">

                    <li id = 'dev_list'  class="nav-item dropdown">
                      <a  class="nav-link dropdown-toggle" data-toggle="dropdown" style="font-size:13px;" href="#">device_list</a>
                      <div  class="dropdown-menu" >
                          <a class="dropdown-item" href="#" name="Covidien/BIS">Covidien/BIS</a>
                          <a class="dropdown-item" href="#" name="Dräger/Primus">Dräger/Primus</a>
                          <a class="dropdown-item" href="#" name="Deltex/CardioQ">Deltex/CardioQ</a>
                          <a class="dropdown-item" href="#" name="Edwards/EV1000">Edwards/EV1000</a>
                          <a class="dropdown-item" href="#" name="Edwards/Vigilance">Edwards/Vigilance</a>
                          <a class="dropdown-item" href="#" name="Masimo/Root">Masimo/Root</a>
                          <a class="dropdown-item" href="#" name="Medtronic/INVOS">Medtronic/INVOS</a>
                      </div>
                </div>
            </li>
          </ul>
        </ul>
            <div class="col-md-2 ">
                <input type="text" id="device" name="device" size="15" autocomplete="off" maxlength="15">
                 <input style="font-size:15px;" type="submit" value="Submit"/>
            </div>
        </form>Operation_time
        <div class="col-md-6 ">
            <label style="font-size:15px;text-align:right;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                수집률 : 수술 70% 이상 저장 환자</label>
        </div>

    </div>






    <div class="container-md">

            <div class="card">
                <h2 style="text-align:center">Operation</h2>
                <div class="card-body">
                    <canvas id='all' height="100", width="1600"></canvas>
                </div>
            </div>

{#            <canvas id='all' height="5vh", width="5vw"></canvas>#}
    <div class="row layer">
            <div class="col-md">
                <div class="card">
                    <h2 style="text-align:center">Operation room</h2>
                    <div class="card-body">
                        <canvas id='graph' height="2000", width="1600"></canvas>
                    </div>
                </div>
            </div>

            </div>
    </div>



    <div class="container-md">

            <div class="card">
            <h2 style="text-align:center">Operation time</h2>
                <div class="card-body">
               <canvas id='all_time' height="100", width="1600"></canvas>

                </div>

            </div>

    <div class="row layer">

            <div class="col-md">
                <div class="card">
                                    <h2 style="text-align:center">room</h2>
                    <div class="card-body">
                        <canvas id='grapht' height="2000", width="1600"></canvas>
                    </div>
                </div>
            </div>

            </div>
    </div>
</div>


<script>

    $('#dev_list a').on('click', function(){
        $('#device').val($(this).text());
    }  );
  $( "#datepicker" ).datepicker();
    $( "#datepicker2" ).datepicker();
$(".nav-link a").on("click", function(){
   $(".nav").find(".active").removeClass("active");
   $(this).parent().addClass("active");
});
</script>

  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="pull-right hidden-xs">
      <b>Version</b> 1.0.0
    </div>
    <strong>Copyright &copy; 2019 </strong>
  </footer>
  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Create the tabs -->
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

    <!-- Bootstrap 3.3.7 -->
    <script src="static/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- Morris.js charts -->
    <script src="static/bower_components/raphael/raphael.min.js"></script>
    <script src="static/bower_components/morris.js/morris.js"></script>
    <!-- Sparkline -->
    <script src="static/bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
    <!-- jvectormap -->
    <script src="static/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="static/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <!-- jQuery Knob Chart -->
    <script src="static/bower_components/jquery-knob/dist/jquery.knob.min.js"></script>
    <!-- daterangepicker -->
    <script src="static/bower_components/moment/min/moment.min.js"></script>
    <script src="static/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
    <!-- datepicker -->
    <script src="static/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <!-- Bootstrap WYSIHTML5 -->
    <script src="static/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
    <!-- Slimscroll -->
    <script src="static/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src="static/bower_components/fastclick/lib/fastclick.js"></script>
    <!-- AdminLTE App -->
    <script src="static/dist/js/adminlte.min.js"></script>
    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <!--<script src="../dist/js/pages/dashboard.js"></script>-->

    <!--<script src="../dist/js/pages/dashboard2.js"></script>-->
    <!-- AdminLTE for demo purposes -->
    <script src="static/dist/js/demo.js"></script>

    <script src="static/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="static/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="static/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="static/bower_components/bootstrap/dist/js/bootstrap.css"></script>
{#    chart    #}
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.bundle.min.js"></script>

</div>
<script>
    Chart.pluginService.register({
      beforeDraw: function(chart) {
        if (chart.config.options.elements.center) {
          // Get ctx from string
          var ctx = chart.chart.ctx;

          // Get options from the center object in options
          var centerConfig = chart.config.options.elements.center;
          var fontStyle = centerConfig.fontStyle || 'Arial';
          var txt = centerConfig.text;
          var color = centerConfig.color || '#000';
          var maxFontSize = centerConfig.maxFontSize || 75;
          var sidePadding = centerConfig.sidePadding || 20;
          var sidePaddingCalculated = (sidePadding / 100) * (chart.innerRadius * 2)
          // Start with a base font of 30px
          ctx.font = "30px " + fontStyle;

          // Get the width of the string and also the width of the element minus 10 to give it 5px side padding
          var stringWidth = ctx.measureText(txt).width;
          var elementWidth = (chart.innerRadius * 2) - sidePaddingCalculated;

          // Find out how much the font can grow in width.
          var widthRatio = elementWidth / stringWidth;
          var newFontSize = Math.floor(30 * widthRatio);
          var elementHeight = (chart.innerRadius * 2);

          // Pick a new font size so it will not be larger than the height of label.
          var fontSizeToUse = Math.min(newFontSize, elementHeight, maxFontSize);
          var minFontSize = centerConfig.minFontSize;
          var lineHeight = centerConfig.lineHeight || 25;
          var wrapText = false;

          if (minFontSize === undefined) {
            minFontSize = 20;
          }

          if (minFontSize && fontSizeToUse < minFontSize) {
            fontSizeToUse = minFontSize;
            wrapText = true;
          }

          // Set font settings to draw it correctly.
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          var centerX = ((chart.chartArea.left + chart.chartArea.right) / 2);
          var centerY = ((chart.chartArea.top + chart.chartArea.bottom) / 2);
          ctx.font = fontSizeToUse + "px " + fontStyle;
          ctx.fillStyle = color;

          if (!wrapText) {
            ctx.fillText(txt, centerX, centerY);
            return;
          }

          var words = txt.split(' ');
          var line = '';
          var lines = [];

          // Break words up into multiple lines if necessary
          for (var n = 0; n < words.length; n++) {
            var testLine = line + words[n] + ' ';
            var metrics = ctx.measureText(testLine);
            var testWidth = metrics.width;
            if (testWidth > elementWidth && n > 0) {
              lines.push(line);
              line = words[n] + ' ';
            } else {
              line = testLine;
            }
          }

          // Move the center up depending on line height and number of lines
          centerY -= (lines.length / 2) * lineHeight;

          for (var n = 0; n < lines.length; n++) {
            ctx.fillText(lines[n], centerX, centerY);
            centerY += lineHeight;
          }
          //Draw text in center
          ctx.fillText(line, centerX, centerY);
        }
      }
    });



function drawpiechart(ctx,total,com){

    var myPieChart = new Chart(ctx, {
        type: 'doughnut',
      data: {
        labels: ['Stored','lost'],
      datasets: [{

          label: "ALL",
          // notice the gap in the data and the spanGaps: true
          data: [com,total-com],
          backgroundColor: ['lightblue','lightgray'],
        }]
        },

        options:{

            responsive: false,
            elements:{
                center:{
                    text:Math.round((com*100/total),0).toString() + '%',
                    color:'#ff6384',
                    fontStyle:'Arial',
                    sidePadding:20,
                    minFontSize:15,
                    lineHeight:15,
                }
            }
        }
      {#options: options#}
    });

}

function stacked_bar(ctx,room,total,com,device) {
    var chart = new Chart(ctx, {
        type: 'horizontalBar',

        data: {
            labels: room,
            datasets: [{
                      {#barPercentage: 1.0,#}
                label: 'Deivce',
                data: device,
                backgroundColor: "burlywood",
            },
                {

                      {#barPercentage: 1.0,#}
                label: 'Stored',
                data: com,
                backgroundColor: "lightblue",
            }, {
                      {#barPercentage: 1.0,#}
                label: 'Lost',
                data: total,
                backgroundColor: "lightgray",
            }
            , ]
        },

        options: {
            responsive: false,
            legend: {
                display: false,
                position: 'right'
            },
            scales: {
                xAxes: [{
                    position:'top',
                    autoSkip : false,
                    stacked: true
                }],
                yAxes: [{

                    stacked: true
                }]
            }
        }
    });

}


function stacked_bar2(ctx,room,total,com,device) {
    var chart = new Chart(ctx, {
        type: 'horizontalBar',
        data: {
            labels: room,
            datasets: [
                {
                      {#barPercentage: 1.0,#}
                label: 'device',
                data: device,
                backgroundColor: "burlywood",
            },
                {
                      {#barPercentage: 1.0,#}
                label: 'Stored',
                data: com,
                backgroundColor: "lightblue",
            }, {
                      {#barPercentage: 1.0,#}
                label: 'lost',
                data: total,
                backgroundColor: "lightgray",
            },  ]
        },

        options: {
            responsive: false,
            legend: {
                display: false,
                position: 'right'
            },
            scales: {
                xAxes: [{
                    position:'top',
                    autoSkip : false,
                    stacked: true
                }],
                yAxes: [{
                    stacked: true
                }]
            },

        }
    });

}

function stacked_bar_main(ctx,total,com) {
    var chart = new Chart(ctx, {
        type: 'horizontalBar',
        data: {
            labels: ['Total'],
            datasets: [{
                      {#barPercentage: 1.0,#}
                label: 'Stored',
                data: com,
                backgroundColor: "lightblue",
            }, {
                      {#barPercentage: 1.0,#}
                label: 'lost',
                data: total,
                backgroundColor: "lightgray",
            } ]
        },
        options: {
            responsive: false,
            legend: {
                {#display: false,#}
                position: 'right'
            },
            scales: {
                xAxes: [{

                    autoSkip: false,
                    stacked: true
                }],
                yAxes: [{
                    stacked: true
                }]
            },
        }

    });

}

data = {{ data_json|safe }}

devices = {{devices_json|safe }}

var test_1 = {{total}}
var test_2 =     {{ complete }}

var ctx1 = document.getElementById('all').getContext('2d');
stacked_bar_main(ctx1,[test_1],[test_2])


var ctx4 = document.getElementById('all_time').getContext('2d');
stacked_bar_main(ctx4,[{{ surgery_time }}], [{{exist_time}}])

{#var ctx3 = document.getElementById('all_time').getContext('2d');#}
{#drawpiechart(ctx3, {{exist_time}},{{ surgery_time }})#}
var room = []
var collected = []
var missing = []
var exist_time = []
var surgery_time = []
var device_time = []
var device_collected = []

    {% if 1 %}
        {% for key,val in data.items %}

            {% if '01' in key %}
            room.push('{{key}}'[0])
            missing.push(0)
            collected.push(0)
            exist_time.push(0)
            surgery_time.push(0)

            {% endif %}


            room.push('{{key}}')
            missing.push(data['{{key}}']['total']-data['{{key}}']['complete'])
            collected.push(data['{{key}}']['complete'] - data['{{key}}']['device_complete'])
            exist_time.push(data['{{key}}']['exist_time'] - data['{{key}}']['device_exist_time'])
            surgery_time.push(data['{{key}}']['surgery_time'] - data['{{key}}']['exist_time'])
            device_time.push(data['{{key}}']['device_exist_time'])
            device_collected.push(data['{{key}}']['device_complete'])


        {% endfor %}



        var ctx2 = document.getElementById('graph').getContext('2d');
        {#stacked_bar(ctx2,data['{{key}}']['total'],data['{{key}}']['complete'])#}
        stacked_bar(ctx2,room,missing,collected,device_collected)

        var ctx4 = document.getElementById('grapht').getContext('2d');
        {#stacked_bar(ctx2,data['{{key}}']['total'],data['{{key}}']['complete'])#}
        stacked_bar2(ctx4,room,surgery_time,exist_time,device_time)
    {% endif %}


        {#room = []#}
        {#collected = []#}
        {#missing = []#}



</script>


</body>
</html>
